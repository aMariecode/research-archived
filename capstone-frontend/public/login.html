<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Welcome â€” UA Research Archive</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
  <!-- Admin padlock button top-right -->
  <div style="position: absolute; top: 20px; right: 30px; z-index: 1000;">
    <button class="btn btn-light shadow" style="border-radius:50%;padding:0.5rem 0.7rem;font-size:1.7rem;" onclick="window.location.href='admin-login.html'" title="Admin Login">
      <i class="bi bi-lock-fill"></i>
    </button>
  </div>
  <div class="auth-page">
    <!-- Left Side - Branding -->
    <div class="auth-left">
      <div class="auth-logo">
        <img src="ua-seal.png" alt="University of the Assumption" class="auth-logo-image">
        <div>
          <h1 style="font-size: 2rem; margin: 0; font-weight: 700;">University of the Assumption</h1>
          <span style="opacity: 0.85; font-size: 0.9rem;">College of Information Technology</span>
        </div>
      </div>
      
      <h1>Welcome to UA<br>Capstone Library</h1>
      <p>Access and explore innovative capstone projects created by IT students. Browse research papers, view abstracts, and download project documentation.</p>
      
      <div class="auth-features">
        <div class="auth-feature">
          <div class="auth-feature-icon">
            <i class="bi bi-search"></i>
          </div>
          <div>
            <h4>Search & Discover</h4>
            <p>Find projects by title, author, year, or keywords</p>
          </div>
        </div>
        <div class="auth-feature">
          <div class="auth-feature-icon">
            <i class="bi bi-file-earmark-pdf"></i>
          </div>
          <div>
            <h4>View & Download</h4>
            <p>Access full documentation and research papers</p>
          </div>
        </div>
        <div class="auth-feature">
          <div class="auth-feature-icon">
            <i class="bi bi-bookmark-star"></i>
          </div>
          <div>
            <h4>Curated Collection</h4>
            <p>Browse approved capstone projects from all batches</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Right Side - Auth Form -->
    <div class="auth-right">
      <div class="auth-form-container">
        <h2>Get Started</h2>
        <p class="subtitle">Sign in to access the archive or create a new account</p>
        
        <!-- Tabs -->
        <div class="auth-tabs">
          <button class="auth-tab active" id="loginTabBtn" onclick="showTab('login')">Sign In</button>
          <button class="auth-tab" id="registerTabBtn" onclick="showTab('register')">Register</button>
        </div>
        
        <!-- Login Form -->
        <div id="loginForm">
          <div id="loginError" class="form-error" style="display:none"></div>
          
          <div class="form-group">
            <label for="loginEmail">Email Address</label>
            <input type="email" id="loginEmail" placeholder="Enter your email" required autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          </div>
          
          <div class="form-group">
            <label for="loginPassword">Password</label>
            <div class="password-wrapper">
              <input type="password" id="loginPassword" placeholder="Enter your password" required autocomplete="new-password" autocorrect="off" autocapitalize="off" spellcheck="false">
              <i class="bi bi-eye-slash password-toggle" onclick="togglePassword('loginPassword', this)"></i>
            </div>
          </div>
          
          <button id="loginBtn" class="btn btn-primary w-100 btn-lg" onclick="doLogin()">
            <i class="bi bi-box-arrow-in-right"></i> Sign In
          </button>

            <button class="btn btn-outline-danger w-100 btn-lg mt-2" onclick="window.location.href='admin-login.html'">
            <!-- Admin login button removed, only icon remains at top -->
            </button>
          
          <div id="googleSignIn" class="d-flex justify-content-center">
            <!-- Google Sign-In button will be rendered here -->
          </div>
        </div>
        
        <!-- Register Form -->
        <div id="registerForm" style="display:none">
          <div id="regError" class="form-error" style="display:none"></div>
          
          <div class="form-group">
            <label for="regName">Full Name</label>
            <input type="text" id="regName" placeholder="Enter your full name" required autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          </div>
          
          <div class="form-group">
            <label for="regEmail">Email Address</label>
            <input type="email" id="regEmail" placeholder="Enter your email" required autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          </div>
          
          <div class="form-group">
            <label for="regSchool">School / Institution</label>
            <input type="text" id="regSchool" placeholder="e.g., University of the Assumption" required autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          </div>
          
          <div class="form-group">
            <label for="regPassword">Password</label>
            <div class="password-wrapper">
              <input type="password" id="regPassword" placeholder="Create a password" required autocomplete="new-password" autocorrect="off" autocapitalize="off" spellcheck="false">
              <i class="bi bi-eye-slash password-toggle" onclick="togglePassword('regPassword', this)"></i>
            </div>
          </div>
          
          <button id="registerBtn" class="btn btn-success w-100 btn-lg" onclick="doRegister()">
            <i class="bi bi-person-plus"></i> Create Account
          </button>
        </div>
        
        <p class="text-center text-muted mt-3" style="font-size: 0.85rem;">
          By continuing, you agree to the terms of service.
        </p>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const BACKEND = `https://research-archived.onrender.com/api`;
    
    // Tab switching
    function showTab(tab) {
      document.getElementById('loginForm').style.display = tab === 'login' ? 'block' : 'none';
      document.getElementById('registerForm').style.display = tab === 'register' ? 'block' : 'none';
      document.getElementById('loginTabBtn').classList.toggle('active', tab === 'login');
      document.getElementById('registerTabBtn').classList.toggle('active', tab === 'register');
      // Clear errors
      document.getElementById('loginError').style.display = 'none';
      document.getElementById('regError').style.display = 'none';
    }
    
    function showError(id, msg) {
      const el = document.getElementById(id);
      if (!msg) { el.style.display = 'none'; return; }
      el.textContent = msg;
      el.style.display = 'block';
    }
    
    // Login
    async function doLogin() {
      showError('loginError', '');
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      if (!email || !password) {
        showError('loginError', 'Please enter email and password');
        return;
      }
      
      try {
        const res = await fetch(`${BACKEND}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const body = await res.json();
        
        if (!res.ok) {
          showError('loginError', body.message || 'Login failed');
          return;
        }
        
        const token = body.accessToken || body.token;
        if (!token || token === 'undefined' || token === 'null') {
          showError('loginError', 'Login failed: missing access token');
          return;
        }

        localStorage.setItem('accessToken', token);
        localStorage.setItem('user', JSON.stringify(body.user));
        
        // Redirect based on role
        if (body.user.role === 'Admin') {
          window.location.href = '/admin.html';
        } else {
          window.location.href = '/index.html';
        }
      } catch (err) {
        showError('loginError', 'Network error. Please try again.');
      }
    }
    
    // Register
    async function doRegister() {
      showError('regError', '');
      const fullName = document.getElementById('regName').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const password = document.getElementById('regPassword').value;
      
      if (!fullName || !email || !password) {
        showError('regError', 'Please fill in all required fields');
        return;
      }
      
      try {
        const res = await fetch(`${BACKEND}/auth/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ fullName, email, password })
        });
        const body = await res.json();
        
        if (!res.ok) {
          showError('regError', body.message || 'Registration failed');
          return;
        }
        
        const token = body.accessToken || body.token;
        if (!token || token === 'undefined' || token === 'null') {
          showError('regError', 'Registration failed: missing access token');
          return;
        }

        localStorage.setItem('accessToken', token);
        localStorage.setItem('user', JSON.stringify(body.user));
        
        // Redirect based on role
        if (body.user.role === 'Admin') {
          window.location.href = '/admin.html';
        } else {
          window.location.href = '/index.html';
        }
      } catch (err) {
        showError('regError', 'Network error. Please try again.');
      }
    }
    
    // Enter key handlers
    document.getElementById('loginPassword').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') doLogin();
    });
    document.getElementById('regPassword').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') doRegister();
    });

    // Toggle password visibility
    function togglePassword(inputId, icon) {
      const input = document.getElementById(inputId);
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('bi-eye-slash');
        icon.classList.add('bi-eye');
      } else {
        input.type = 'password';
        icon.classList.remove('bi-eye');
        icon.classList.add('bi-eye-slash');
      }
    }
    
    // Check if already logged in
    const token = localStorage.getItem('accessToken');
    const user = localStorage.getItem('user');
    if (token && token !== 'undefined' && token !== 'null' && user) {
      try {
        const userData = JSON.parse(user);
        if (userData.role === 'Admin') {
          window.location.href = '/admin.html';
        } else {
          window.location.href = '/index.html';
        }
      } catch (e) {}
    } else if (token === 'undefined' || token === 'null') {
      localStorage.removeItem('accessToken');
    }
  </script>
</body>
</html>
